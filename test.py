import time
from time import sleep

import PIL

from PIL.Image import Image
from PIL.ImageDraw import ImageDraw
from luma.emulator import device

from luma.core.legacy import text
from luma.core.legacy.font import proportional, CP437_FONT, TINY_FONT, SINCLAIR_FONT, LCD_FONT

dev = device.pygame(32, 24, 0, '1', "led_matrix")

font1 = [[0x00] * 4] * 0x30
font1.extend([
        [0x3E, 0x41, 0x41, 0x41, 0x3E, 0x00],  # '0'
        [0x44, 0x42, 0x7F, 0x40, 0x40, 0x00],  # '1'
        [0x62, 0x51, 0x51, 0x51, 0x4E, 0x00],  # '2'
        [0x22, 0x49, 0x49, 0x49, 0x36, 0x00],  # '3'
        [0x30, 0x28, 0x24, 0x22, 0x7F, 0x00],  # '4'
        [0x27, 0x45, 0x45, 0x45, 0x39, 0x00],  # '5'
        [0x3E, 0x45, 0x45, 0x45, 0x38, 0x00],  # '6'
        [0x01, 0x71, 0x09, 0x05, 0x03, 0x00],  # '7'
        [0x36, 0x49, 0x49, 0x49, 0x36, 0x00],  # '8'
        [0x0E, 0x51, 0x51, 0x51, 0x3E, 0x00],  # '9'
        [0x22, 0x00],  # ':'
    ])

font2 = [[0x00] * 4] * 0x30
font2.extend([
        [0x3E, 0x41, 0x41, 0x3E, 0x00],  # '0'
        [0x04, 0x42, 0x7F, 0x40, 0x00],  # '1'
        [0x62, 0x51, 0x51, 0x4E, 0x00],  # '2'
        [0x22, 0x49, 0x49, 0x36, 0x00],  # '3'
        [0x18, 0x14, 0x12, 0x7F, 0x00],  # '4'
        [0x27, 0x45, 0x45, 0x39, 0x00],  # '5'
        [0x3E, 0x45, 0x45, 0x38, 0x00],  # '6'
        [0x01, 0x71, 0x0D, 0x03, 0x00],  # '7'
        [0x36, 0x49, 0x49, 0x36, 0x00],  # '8'
        [0x0E, 0x51, 0x51, 0x3E, 0x00],  # '9'
        [0x00],  # ':'
    ])


img = PIL.Image.new('1', (32, 24))

draw = ImageDraw(img)


while True:
    draw.rectangle([0, 0, 31, 23], 0)

    text(draw, (3, 0), time.strftime("%H:%M"), 255, font1)
    text(draw, (0, 8), time.strftime("%H:%M:%S"), 255, font2)
    text(draw, (0, 16), time.strftime("47"), 255, font2)
    dev.display(img)
    sleep(1)

